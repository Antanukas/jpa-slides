<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Java Persistence Api</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/white.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
        <section data-background-image="bg.png">
          <h2>Darbas su duomenų bazėmis - JPA</h2>
          Antanas Bastys

        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                #### Object-Relational Impedence mismatch

                - objektinio modelio neatitikimias reliaciniui
                - objektinis modelis įsivaizduojamas kaip grafas
                - reliacinis modelis įsiviazduojamas kaip lenteliės (Pvz 'Excel' lentelės)
                - kyla 5 pagrinidinia nesutapimai bandant išsaugoti objektinį modelį reliaciniame
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                #### Object-Relational Impedence mismatch

                - Detalumas: daugiau klasių nei lentelių (adresas)
                - Paveldimumas: ar girdėjote apie tėvines lenteles? :)
                - Lygybė: pirminis raktas prieš `==` ir `equals`
                - Sąryšiai: objektiniame vienpusiai, o reliaciniame dvipusiai
                - Navigacija per duomenis: objektiniai reikia vaiksčioti nuo šaknies
                per sąryšius, o reliacinemiai per `JOIN` sąlygas
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                #### ORM

                - ORM - Object Relational Mapping
                - Būdas susieti reliacines duomenų bazes su objektinėmis duomenų struktūromis
                - JPA - Standartas apibrėžiantis, kaip ORM biblioteka turi vieikti
                - JPA implementacijos: Hibernate, EclipseLink, kitos
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                #### Privalumai

                - Java duomenų klasės automatiškai susiejamos su reliacinu modeliu
                - Paslepiai duomenų bazės struktūrą
                - Pakankamai lengviau dirbti su keliomis reliacinių bazių implementacijomis
                - Palyginus su pliku JDBC žymiai mažiau `boilerplate` kodo
                - Supraprastina sudėtingesnių objektų grafų užkrovimą
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                #### Trūkumai

                - Labai sudėtinga bibliotekos implementacija
                - Dažnai kažkas 'magiškai' pradeda veikti vien uždėjus anotaciją
                - Beveik visada sudėtingesniais atvejais darbas su duomenų bazę
                tampa neoptimalus ir reikalauja gilesnių žinių apie ORM biblioteką
                - Sudėtingesniais atvejais išlenda faktas, jog naudojama realiacinė duomenų bazė
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                #### JPA - `EntityManager`

                - find(Class,Object) - surasti objektą pagal pirminį raktą
                - persist(Object) - išsaugoti ir pradėti valdyti objektą
                - merge(Object) - išsaugoti objekto pakeitimus
                - refresh(Object) - gauti objekto pasikeitimus iš DB
                - remove(Object) - pašalinti objektą

            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
          #### JPA - Esybės (entities)

          ```
          @Entity
          public class Good {
              @Id
              private Integer id;

            private String name;

            // geteriai ir seteriai
          }

          ```

          - Saugomas lentelėje 'Good'
          - id laukas - pirminis raktas
          - turi 2 stulpelius - id ir name
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                #### JPA - JPQL

                - Java Persistence Query Language
                - panašu į SQL
                - rašant join'us siejama ne per pirminį raktą, o per lauką klasėje
                - refresh(Object) - gauti objekto pasikeitimus iš DB
                - remove(Object) - pašalinti objektą

            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
              #### JPA -JPQL pavyzdys

              ```
              Query q = entityManager.createQuery("select g from Good g");
              List<Good> goods = q.getResultList();
              ```
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
              #### Integracija su Spring

              ```
              <dependency>
          			<groupId>org.springframework.boot</groupId>
          			<artifactId>spring-boot-starter-data-jpa</artifactId>
          		</dependency>
              ```

              Pagal nutylėjima JPA implementacija yra Hibernate
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                #### Užduotis 1 produktų administravimas

                - Sukurkite 3 REST endpointus:
                  - GET /products - sąrašas produktų
                  - POST /products - sukurimas naujo produkto
                  - GET /products?title=produktoPavadinimasPaieskai - sugrąžina produktų sąrašą kurių pavadinimai sutampa
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                `$ git init` - paruošia dabartinį katalogą kaip git repositoriją
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                `$ git add <path>`

                Pridėti viską iš dabartinio katalogo:

                ```$ git add .```
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                `$ git status` - dabartinė repositorijos būsena.
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
              ![gitstatus](gitstatus.png "Git Status")

              Bus "sucommitinti" žalių failų pakeitimai
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                `$ git commit -m <message>`

                Komanda, atliekama pabaigus darbą ar jo etapą su failais.
                Susikuria changeset'as, turintis informaciją apie pasikeitusius failus.
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                `$ git log` - commit'ų istorija dabartinėje šakoje

                ![gitlog](gitlog.png "Git Log")
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                ![idomu](idomu.jpg "idomu")
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                #### Užduotis 1

                - susikurkite katalogą: `studentai`
                - inicijuokite jame git repositoriją
                - sukurkite failą `studentai.dat`
                - atverkite failą ir irašykite į jį savo vardą ir pavardę
                - "sucommitinkite" pakeitimus
                - peržvelkite, ar istorijoje atsirado commit'as
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                #### Užduotis 1 - galimas sprendimas

                ```
                $ mkdir studentai
                $ cd studentai
                $ git init
                $ echo "Jonas Petraitis" >> studentai.dat
                $ git add studentai.dat
                $ git commit -m "Added my name to studentai.dat"
                $ git log
                ```
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                #### .gitignore

                - dažnai turime failų, kurie neturi būti commit'inami
                  - `.eclipse` konfigūracija
                  - `target` katalogas atsirandantis build'o metu
                  - kiti failai specifiniai konkrečiam vartotojui
                - `.gitignore` tekstinis failas leidžia nurodyti šablonus kelių, kurie neturi būti tvarkomi Git'o
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                #### .gitignore

                ```
                .gradle
                /build/
                !gradle/wrapper/gradle-wrapper.jar
                h2
                logs

                target
                *.iml
                .idea
                ```
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                #### Šakos (branch)

                - pagal nutylėjimą sukuriamas "master branch'as"
                - naujus branch'us kuria vartotojai
                - kiekvienai programavimo užduočiai naudojami atskiri branch'ai. Pabaigtos užduoties pakeitimai perkeliami į "master" branch'ą
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                ```
                $ git checkout -b test
                Switched to a new branch 'test'

                $ git branch
                  master
                * test

                $ git checkout master
                Switched to branch 'master'

                $ git branch
                * master
                  test
                ```
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                `$ git merge <branch-name>` - Atlikti merge commit'ą, perkeliant nurodyto branch'o pakeitimus į dabartinį branch'ą
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                ```
                $ git branch
                * master
                  test
                $ echo "master branch tekstas" >> file
                $ git add .
                $ git commit -m "Master commitas"
                [master 2a5c8f1] Master commitas
                 1 file changed, 1 insertion(+)
                ```
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                ```
                $ git checkout -b naujas
                Switched to a new branch 'naujas'
                $ echo "naujas branch tekstas" >> file
                $ git add .
                $ git commit -m "Naujas commitas"
                [naujas 52f1927] Naujas commitas
                 1 file changed, 1 insertion(+)
                $ git checkout master
                Switched to branch 'master'
                ```
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                ```
                $ cat file
                master branch tekstas
                $ git merge naujas
                Updating 2a5c8f1..52f1927
                Fast-forward
                 file | 1 +
                 1 file changed, 1 insertion(+)
                $ cat file
                master branch tekstas
                naujas branch tekstas
                ```
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                #### Git istorijos naršymas

                Dažnai labai patogu tai daryti grafiniais įrankiais

                ```
                $ sudo apt-get install gitg
                $ gitg
                ```

            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                ![cdsgitlog](cdsgitlog.png "Gitg")
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                #### Git rodyklės (pointers)

                - `HEAD` - dabartinės būsenos rodyklė
                - Gudresni pavyzdžiai http://www.paulboxley.com/blog/2011/06/git-caret-and-tilde
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                #### Commit ID

                - `52f192703d9951f5bbaa55fc41c0c78bba811a49`
                - unikaliai nusakyti commit'ą pakanka 7 pirmų simbolių `52f1927`
                - žinant commit'o id, galima atlikti visokių veiksmų, pavyzdžiui nukreipti HEAD'ą į šį commit'ą
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
              ```
              $ git checkout 52f1927

              You are in 'detached HEAD' state. You can look around, make experimental
              changes and commit them, and you can discard any commits you make in this
              state without impacting any branches by performing another checkout.

              If you want to create a new branch to retain commits you create, you may
              do so (now or later) by using -b with the checkout command again. Example:

                git checkout -b <new-branch-name>

              HEAD is now at 52f1927... Naujas commitas

              ```
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
              #### Merge konfliktai

              - Įvyksta kai ta pati failo vieta buvo modifikuota kelių vartotojų
              - Galimi `merge` ir `pull` komandų metu
              - Ištaisius konfliktus failuose, juos reikia add'inti ir "sucommitinti" nekeinčiant commit'o pranešimo
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
              #### Konflikto pavyzdys

              ```
              Jonas Petraitis
              <<<<<<< HEAD
              1985-01-09
              =======
              Vilnius
              >>>>>>> gimimo-vieta
              ```

              - `<<<<<<<` ir `>>>>>>>` žymi konfliktuojančios dalies pradžią ir pabaigą
              - `<<<<<<< HEAD` nurodo, jog konfliktuojantis blokas yra iš branch'o, į kurį "merginame"
              - `=======` atskiria dalis tarp branch'ų
              - `>>>>>>> gimimo-vieta` nurodo, jog dalis tarp `=======` ir `>>>>>>>` yra iš branch'o `gimimo-vieta`
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
              #### Užduotis 2

              - Įsitikinkite, kad esate `master` branch'e
              - Sukurkite branch'ą pavadinimu `gimimo-data`
              - Tame branch'e į failą studentai.dat naujoje eilutėje įrašykite savo gimimo datą
              - "Sucommitinkite"
              - Grįžkite į `master` branch'ą
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
              #### Užduotis 2

              - Sukurkite branch'ą `gimimo-vieta`
              - Tame branch'e į failą studentai.dat naujoje eilutėje įrašykite savo gimimo vietą
              - "Sucommitinkite"
              - Grįžkite į `master` branch'ą
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
              #### Užduotis 2

              - "Įmerginkite" gimimo datos pakeitimus į master branch'ą
              - "Įmerginkite" gimimo vietos pakeitimus į master branch'ą
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                #### Užduotis 2 - galimas sprendimas

                ```
                $ git checkout -b gimimo-data
                Switched to a new branch 'gimimo-data'
                ```
                ```
                $ echo "1985-01-03" >> studentai.dat
                $ git add .
                $ git commit -m "Gimimo data"
                [gimimo-data 1da96ec] Gimimo data
                 1 file changed, 1 insertion(+)
                ```
                ```
                $ git checkout master
                Switched to branch 'master'
                ```
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                #### Užduotis 2 - galimas sprendimas

                ```
                $ git checkout -b gimimo-vieta
                Switched to a new branch 'gimimo-vieta'
                ```
                ```
                $ echo "Vilnius" >> studentai.dat
                $ git add .
                $ git commit -m "Gimimo vieta"
                [gimimo-vieta a309462] Gimimo vieta
                 1 file changed, 1 insertion(+)
                ```
                ```
                $ git checkout master
                Switched to branch 'master'
                ```
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                #### Užduotis 2 - galimas sprendimas

                ```
                $ git merge gimimo-data
                Updating f9f86f9..1da96ec
                Fast-forward
                 studentai.dat | 1 +
                 1 file changed, 1 insertion(+)
                ```
                ```
                $ git merge gimimo-vieta
                Auto-merging studentai.dat
                CONFLICT (content): Merge conflict in studentai.dat
                Automatic merge failed; fix conflicts and then commit the result.
                ```
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                #### Užduotis 2 - galimas sprendimas

                ```
                $ gedit studentai.dat # pataisome konfliktus faile
                ```

                ```
                Jonas Petraitis
                <<<<<<< HEAD
                1985-01-03
                =======
                Vilnius
                >>>>>>> gimimo-vieta
                ```

                ```
                Jonas Petraitis
                1985-01-03
                Vilnius
                ```
                ```
                $ git add .
                $ git commit
                [master 5c8fae3] Merge branch 'gimimo-vieta'
                ```
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                #### Decentralizacija

                - Kiekviena Git'o repositorija yra kažkurio laiko momento kopija.
                - Ji gali nepriklausomai vystytis
                - Dažniausiai yra Git Serveris, kuris yra centrinė repositorija (origin)
                - Populiariausi serveriai: https://github.com, https://gitlab.com, https://bitbucket.org
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
              #### Remote repositorijos

              - Dažniausiai būna viena centrinė remote repositorija, vadinama 'origin'
              - Kuriant naują git repositoriją (`git init`) ją reikia prisidėti pačiam (`git remote add`)
              - Klonuojant (`git clone`) egzistuojančią repositoriją, ji pridedama automatiškai
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
              `$ git remote add <name> <repository>`

              ```
              $ git remote add origin git@github.com:Antanukas/it-akademija-java-tech.git
              $ git remote -v
               origin  git@github.com:Antanukas/it-akademija-java-tech.git (fetch)
               origin  git@github.com:Antanukas/it-akademija-java-tech.git (push)
              ```
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
              `$ git clone <repository>`

              ```
              $ git clone git@github.com:Antanukas/it-akademija-java-tech.git
              ```
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
                `remote` ar `clone` repositoriumo radimas

                ![cloneexample](cloneexample.png "Clone example")
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
              #### Lokalios repo sinchronizacija

              `$ git pull` arba `$ git fetch`
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
              #### pull vs fetch

              - fetch - atsisiunčia pakeitimus iš repositorijos, bet nepritaiko jų lokaliai kopijai
              - pull - padaro tą patį, ką ir fetch, bet pritaiko gautus pakeitimus, o dėl to gali reikėti merge'o
                - techniškai git pull atveju vyksta tokia komandų seka, jei esame master'yje:
                ```
                $ git fetch
                $ git merge remotes/origin/master
                ```
              - dažniausiai visada darome `git pull` ir nesukame galvos
              - kad atsinaujintų visi branch'ai, galima daryti `git pull --all`
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
              #### Lokalių pakeitimų išstumimas į remote'ą

              `$ git push origin <branch-name>`

              - jei remote'as pabėgęs į priekį, bus atspausdinta klaida
                - tokiu atveju reikia atlikti `git pull`, ispręsti merge konfliktus ir bandyti dar kartą
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
              #### Užduotis 3

              - Susikurkite Github'o vartotoją
              - Susikurkite Gihtub'e repositoriją
              - Prisidėkite remote'ą
              - Perkelkite į Github'ą prieš tai užduotyse sukurtą repositoriją
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
              #### Pasimokyti patiems

              - https://git-scm.com/book/en/v2
                - Pirmi 2 skyriai is a MUST
                - 3 skyrius smalsiems
                - visa knyga rimtiems
              - http://learngitbranching.js.org/
            </script>
        </section>
        <section data-markdown data-background-image="sbg.png">
            <script type="text/template">
              Pabaiga

              ![jesus](jezus.jpg "jesus")
            </script>
        </section>

			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				history: true,
        controls: false,
				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});

      Reveal.configure({ slideNumber: 'c' });
		</script>
	</body>
</html>
